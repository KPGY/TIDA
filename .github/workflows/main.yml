name: Automatic Nextron Release

# master ë¸Œëœì¹˜ì— í‘¸ì‹œë  ë•Œ ì‹¤í–‰
on:
  push:
    branches:
      - master

jobs:
  release:
    runs-on: ubuntu-latest
    
    # â—ï¸ ë¦´ë¦¬ì¦ˆ ìƒì„± ë° íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•´ ê¶Œí•œ ì„¤ì •
    permissions:
      contents: write # ë¦´ë¦¬ì¦ˆ ìƒì„± ë° íŒŒì¼ ì—…ë¡œë“œ, íƒœê·¸ í‘¸ì‹œì— í•„ìš”
      
    steps:
      - name: â¬‡ï¸ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ› ï¸ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # í”„ë¡œì íŠ¸ì— ë§ëŠ” Node.js ë²„ì „ìœ¼ë¡œ ì„¤ì •

      - name: ğŸ“¥ Install dependencies
        run: npm install
          
      - name: âš™ï¸ Configure Git User
        run: |
          # Git ì‘ì—…(ë²„ì „ ì»¤ë°‹ ë° íƒœê·¸)ì„ ìœ„í•œ ì‚¬ìš©ì ì •ë³´ ì„¤ì •
          git config user.name "GitHub Actions Bot"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"

      ---
      
      # 1. ë²„ì „ ì¦ê°€ ë° íƒœê·¸ ìƒì„±
      # package.jsonì˜ ë²„ì „ì„ ì˜¬ë¦¬ê³ , Gitì— ì»¤ë°‹í•˜ë©°, ìƒˆ íƒœê·¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
      - name: â¬†ï¸ Increment Version and Tag
        # ì˜ˆì‹œë¡œ 'patch' ë²„ì „ì„ ì˜¬ë¦¬ì§€ë§Œ, 'minor' ë˜ëŠ” 'major'ë¡œ ë³€ê²½ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        run: npm version patch 
        
      # 2. ì»¤ë°‹ê³¼ íƒœê·¸ë¥¼ ì›ê²© ì €ì¥ì†Œì— í‘¸ì‹œ
      # nextron buildê°€ ë¦´ë¦¬ì¦ˆë¥¼ ìƒì„±í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ íƒœê·¸ë¥¼ GitHubì— ì „ì†¡í•©ë‹ˆë‹¤.
      - name: ğŸš€ Push Commits and Tags
        run: git push && git push --tags
        
      ---

      # 3. nextron build ì‹¤í–‰ ë° ì¦‰ì‹œ GitHubì— ë¦´ë¦¬ì¦ˆ ë°œí–‰ (Publish)
      # package.jsonì— ì •ì˜ëœ 'npm run release' ëª…ë ¹ì–´(nextron build -- --publish always) ì‹¤í–‰
      - name: ğŸ“¦ Build and Publish Nextron App
        run: npm run release
        env:
          # electron-builderê°€ ë¦´ë¦¬ì¦ˆë¥¼ ìƒì„±í•˜ê³  íŒŒì¼ì„ ì—…ë¡œë“œí•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
